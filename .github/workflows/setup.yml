name: Setup initial kit name

on:
  workflow_dispatch:
    inputs:
      new_kit_name:
        description: "Set new name for kit. (my-awesome-kit)"
        required: true
      new_kit_abv:
        description: "Kit abreviation. (mak)"
        required: true
  
jobs:
  rename:
    runs-on: ubuntu-latest
    # Only run on new repositories, not the template
    if: github.repository != 'Pixel-Fondue/modo-kit-basic'
    steps:
      - name: Chekout
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Create new branch for changes
        run: |
          git checkout -B rename-branch
      
      - name: Rename Kit
        run: |
          # Rename kit name in index.cfg
          sed -i 's/my_modo_kit/${{ github.event.inputs.new_kit_name }}/g' my-modo-kit/index.cfg
          sed -i 's/my-modo-kit/${{ github.event.inputs.new_kit_name }}/g' my-modo-kit/libs/my_modo_kit/__init__.py
          sed -i 's/mmk/${{ github.event.inputs.new_kit_abv }}/g' my-modo-kit/libs/my_modo_kit/__init__.py
          sed -i 's/mmk/${{ github.event.inputs.new_kit_abv }}/g' my-modo-kit/lxserv/kit_command.py
          sed -i 's/mmk/${{ github.event.inputs.new_kit_abv }}/g' my-modo-kit/configs/commands.cfg
          
          # Rename library folder name
          mv my-modo-kit/libs/my_modo_kit my-modo-kit/libs/${{ github.event.inputs.new_kit_name }}

          # Rename kit folder name
          mv my-modo-kit ${{ github.event.inputs.new_kit_name }}
      
      - name: Apply name changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git commit -m "Rename Modo kit" -a
          git push origin rename-branch
      
      - name: Request Changes
        uses: repo-sync/pull-request@v2
        with:
          destination_branch: 'main'
          source_branch: 'rename-branch'
          github_token: ${{ secrets.GITHUB_TOKEN }}
          pr_title: 'Rename kit to ${{ github.event.inputs.new_kit_name }}'
          pr_body: 'Automated changes by GitHub Action'
